# frozen_string_literal: true

require "rails_helper"

RSpec.describe FetchMalwareScanResultsJob do
  describe "#perform" do
    let!(:stale_pending_upload) do
      create(:upload, :allegation, malware_scan_result: "pending", created_at: 10.minutes.ago)
    end
    let(:malware_scan) { instance_double(Malware::FetchScanResult, call: true) }

    it "fetches malware scan results for stale pending uploads" do
      allow(Malware::FetchScanResult).to receive(:new).with(
        upload: stale_pending_upload
      ).and_return(malware_scan)

      described_class.perform_now
    end
  end
end
