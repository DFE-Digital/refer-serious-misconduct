# frozen_string_literal: true

require "rails_helper"

RSpec.describe Malware::RemoveFile do
  describe "#call" do
    subject(:remove_file) { described_class.new(upload:).call }

    let(:result) { "suspect" }
    let(:upload) { create(:upload, :allegation, malware_scan_result: result) }

    it "removes the upload file" do
      remove_file

      expect(upload.reload.file.filename).to be_nil
      expect(upload.reload.file.download).to be_nil
    end

    context "when the upload does not have a suspect scan result" do
      let(:result) { "clean" }

      it "does not remove the malware blob" do
        remove_file

        expect(upload.reload.file.filename).to be_present
        expect(upload.reload.file.download).to be_present
      end
    end
  end
end
