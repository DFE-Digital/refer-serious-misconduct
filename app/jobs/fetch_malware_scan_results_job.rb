# frozen_string_literal: true

class FetchMalwareScanResultsJob < ApplicationJob
  def perform
    return unless FeatureFlags::FeatureFlag.active?(:malware_scan)

    Upload
      .where(malware_scan_result: "pending")
      .where("created_at < ?", 5.minutes.ago)
      .each { |upload| Malware::FetchScanResult.new(upload:).call }
  end
end
